<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Blog | Circkoooooo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://yuanxin518.github.io/blog"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="keywords" content="前端 react webpack redux git"><meta data-rh="true" property="og:title" content="Blog | Circkoooooo"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yuanxin518.github.io/blog"><link data-rh="true" rel="alternate" href="https://yuanxin518.github.io/blog" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://yuanxin518.github.io/blog" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://58UO1EPKN3-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Circkoooooo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Circkoooooo Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Circkoooooo" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5400edea.css">
<link rel="preload" href="/assets/js/runtime~main.8ced35b2.js" as="script">
<link rel="preload" href="/assets/js/main.27ec5e19.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Yuanxin</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yuanxin518" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">所有内容</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/10/21/ Ant Deisgn模态框内嵌Form的初始值不更新">2023-10-21 Ant Deisgn 模态框内嵌 Form 的初始值不更新</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/10/10/ netlify部署警告导致build中断">netlify 部署警告导致 build 中断</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/10/9/ contentEditable让光标到输入框最后">contentEditable 的 div 元素，让聚焦时光标到最后</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/9/13/ 浏览器环境中渲染表格"> 浏览器环境中渲染表格</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/9/1/ passing props 阻止styled-components的props绑定到原生dom上"> passing props 阻止styled-components的props绑定到原生dom上</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/8/30/ 动态生成自定义svg的解决方法"> 动态生成自定义svg的解决方法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/7/20/ github pr和变基合并提交记录"> github pr和变基合并提交记录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/7/18/ git本地管理到github的关联"> git本地管理到github的关联</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/7/15/ 页面大量dom的优化"> 页面大量dom的优化</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/4/27/ webpack chunk与runtime优化"> webpack chunk与runtime优化</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/10/21/ Ant Deisgn模态框内嵌Form的初始值不更新">2023-10-21 Ant Deisgn 模态框内嵌 Form 的初始值不更新</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-21T00:00:00.000Z" itemprop="datePublished">2023年10月21日</time> · <!-- -->阅读需 2 分钟</div></header><div class="markdown" itemprop="articleBody"><p>在模态框中嵌入了 Form 表格元素，由官方的说法是</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">form</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useForm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">useEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    form</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resetField</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">Modal</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">Form</span><span class="token plain"> form</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">form</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token maybe-class-name">Form</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token maybe-class-name">Modal</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>用 useForm 将 form 绑定到 Form 组件上，通过调用<code>form.resetFields</code>来初始化 initialValue。
但是 useEffect 中调用 reset 的时候，值的变化总是会延迟，这是由于组件的更新策略导致的。</p><p>modal 只挂载了一次，form 也只挂载了一次，所以值的变化是根据 react 的渲染时机来决定的。那么就有一个强制重载组件的方法，可能不是最好的方法，但是能解决问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法">解决方法<a href="#解决方法" class="hash-link" aria-label="解决方法的直接链接" title="解决方法的直接链接">​</a></h3><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">const [visible,setVisible] = useState(false)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token plain">const [form] = useForm()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">useEffect(()=&gt;{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   form.resetField()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">},[visible])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#  组件</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token deleted-arrow deleted prefix deleted" style="color:rgb(255, 85, 114)">&lt;</span><span class="token deleted-arrow deleted line" style="color:rgb(255, 85, 114)">Modal ...&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-arrow deleted line" style="color:rgb(255, 85, 114)"></span><span class="token plain">{visible &amp;&amp; &lt;Modal ...&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   &lt;Form form={form}&gt;&lt;/Form&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-arrow deleted prefix deleted" style="color:rgb(255, 85, 114)">&lt;</span><span class="token deleted-arrow deleted line" style="color:rgb(255, 85, 114)">/Modal&gt;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>监听 visible，来触发 reset 函数，那么每次 visible 改变的时候 modal 都会被销毁或者挂载，随后 form 进行 reset，能始终保持 form 处于最新初始化状态。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/10/10/ netlify部署警告导致build中断">netlify 部署警告导致 build 中断</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T00:00:00.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 1 分钟</div></header><div class="markdown" itemprop="articleBody"><p>在本地build项目和preview没有任何问题，在netlify部署就因为警告导致了命令被中断，那么就要用到环境变量来让CI不进行输出的编译。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案">解决方案<a href="#解决方案" class="hash-link" aria-label="解决方案的直接链接" title="解决方案的直接链接">​</a></h3><p>原本的netlify编译的命令<code>npm run build</code>，修改成<code>CI=false npm run build</code></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/10/9/ contentEditable让光标到输入框最后">contentEditable 的 div 元素，让聚焦时光标到最后</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-09T00:00:00.000Z" itemprop="datePublished">2023年10月9日</time> · <!-- -->阅读需 1 分钟</div></header><div class="markdown" itemprop="articleBody"><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">focus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> inputItemRef</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">current</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">innerText</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> initialValue </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> initialValue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> range </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getSelection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    range</span><span class="token operator" style="color:rgb(137, 221, 255)">?.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">selectAllChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    range</span><span class="token operator" style="color:rgb(137, 221, 255)">?.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">collapseToEnd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这是在React中写的一个函数，所以用了ref来获取input。  </p><p><strong>其中让光标跑到最后的关键是，<code>window.getSelection()</code>的函数，通过range来找到我们需要移动光标的元素，然后调用collapseToEnd就可以让光标跑到最后。</strong></p><p>contentEditable和input并不相同，如果是input元素，可以去调用自身元素上面的函数<code>selectionSetSelectionRange</code>来设定。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/9/13/ 浏览器环境中渲染表格"> 浏览器环境中渲染表格</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-09-13T00:00:00.000Z" itemprop="datePublished">2023年9月13日</time> · <!-- -->阅读需 14 分钟</div></header><div class="markdown" itemprop="articleBody"><p>在网页中渲染一个表格，基本上是这两种方法，一是采用原生的<strong>table标签</strong>，二是通过<strong>div标签+contenteditable属性</strong>来。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-原生table标签和div标签的对比">1. 原生table标签和div标签的对比<a href="#1-原生table标签和div标签的对比" class="hash-link" aria-label="1. 原生table标签和div标签的对比的直接链接" title="1. 原生table标签和div标签的对比的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="table标签">table标签<a href="#table标签" class="hash-link" aria-label="table标签的直接链接" title="table标签的直接链接">​</a></h3><p>原生table标签能够很方便的去渲染出表格，只需要按照table标签的规范来填充数据。</p><p>如果我们要修改它的样式，要通过css来修改每一个部分对应的标签的css属性。例如<code>th</code>,<code>td</code>,<code>td</code>标签等等。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="div实现div代指其他标签">div实现（div代指其他标签）<a href="#div实现div代指其他标签" class="hash-link" aria-label="div实现（div代指其他标签）的直接链接" title="div实现（div代指其他标签）的直接链接">​</a></h3><p>俗话说，万物皆可div。只要我们渲染逻辑写的缜密，我们仍然可以去通过div去实现一套视觉友好，甚至能够符合html5的无障碍规范等等的表格组件出来。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何选择">如何选择<a href="#如何选择" class="hash-link" aria-label="如何选择的直接链接" title="如何选择的直接链接">​</a></h3><p>用table毕竟是已经封装好的原生的组件，所以难免会遇到一些不好解决的，具有局限性的配置等。就比如说，表格中每一个元素的边框，会产生一些重叠，导致内层的边框比外层的边框粗，但是我们可以通过table提供的<code>border-collapse</code>去实现内外边框粗细一致。还有我们想定制这个表格的元素的时候，会发现仍然有很多局限，因为每个元素都已经被规范应该是什么样的位置等，所以想要在元素中嵌入一些自定义的元素，就要花更多的事件去考虑需要怎么嵌入。  </p><p>上述所说的问题在很多场景下没有大碍，但是在一些组件库中，或者在高度定制的表格项目中，我们用原生的table标签并不有利。所以在很多项目例如<code>腾讯表格</code>，没有用原生的table表格来实现，而是通过div等标签来实现的。</p><p>那么用div能有什么好处？首先上述原生table显露出来的一个问题就是，我们的渲染逻辑都局限在了table标签的规范中去了，所有的元素都被规范局限了渲染逻辑。很方便的渲染出一个表格，但问题总是在后期遇到。那么我们何不去封装一套更好的表格渲染逻辑，或者说是一套符合高度自定义的场景，同样暴露出和原生table标签所一致的api等等，但此基础上还暴露出了更多的自定义的api，就像所说的嵌入元素等的api。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-div的渲染设计">2. div的渲染设计<a href="#2-div的渲染设计" class="hash-link" aria-label="2. div的渲染设计的直接链接" title="2. div的渲染设计的直接链接">​</a></h2><p>要实现一个表格，最终要的是渲染出表格的框架，其次就是实现表格的内容编辑的功能，后面就是对单元格的一些操作，以及适应屏幕的逻辑等。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-生成驱动视图的数据">1. 生成驱动视图的数据<a href="#1-生成驱动视图的数据" class="hash-link" aria-label="1. 生成驱动视图的数据的直接链接" title="1. 生成驱动视图的数据的直接链接">​</a></h3><p>表格，首先最容易想到的是用二维数组来实现，二维数组的第一维数据来渲染每一行，将每一行都渲染出来就形成了一个表格。</p><p>arr: <code>[[ ,A,B,C],[1,A1,B1,C1],[2,A2,B2,C2]]</code></p><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>1</td><td>A1</td><td>B1</td><td>C1</td></tr><tr><td>2</td><td>A2</td><td>B2</td><td>C2</td></tr></tbody></table><p>就像上面这样对应起来，arr是最原始的渲染数组，其中包括了表头的数据。在arr<!-- -->[0]<!-- -->中是<code>[,A,B,C..]</code>，第一个是<code>undefined</code>，所以在后面的逻辑中渲染出来的是空白。<em>是否一个表格数据应该包含表头数据？我认为最原始数组最好保留所有的数据，在后面的渲染中进行逻辑排除处理是一个比较好的做法。</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-根据数据来渲染表格">2. 根据数据来渲染表格<a href="#2-根据数据来渲染表格" class="hash-link" aria-label="2. 根据数据来渲染表格的直接链接" title="2. 根据数据来渲染表格的直接链接">​</a></h3><p>数据已经被分为了数组的每一项，那么我们把每一维当行，每一维中的每一项当列即可。那么通过2层二维渲染就可以成功渲染出来。<strong>其中需要做的重要处理就是对空数据的处理，如果为空的时候我们不能单纯的不渲染这个元素，否则这个单元格的宽度和高度不会被撑起来。我们需要对它做标记，在css的处理上要针对性处理。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-编写表格的样式">3. 编写表格的样式<a href="#3-编写表格的样式" class="hash-link" aria-label="3. 编写表格的样式的直接链接" title="3. 编写表格的样式的直接链接">​</a></h3><p>如果我们单独为每个单元格都编写上下左右的边框，那就会出现边框重叠的问题，内部的宽度比外围的宽度粗，并且表格也出现了不对其的问题。</p><p>要解决边框粗细一致，在渲染的时候采取一定的措施，就是<strong>按一个方向去渲染表格的边框</strong>。比如说，只渲染表格的右边和下边的边框，最后渲染出来的结果就是没有任何的单元格边框被重叠，但是第一列和第一行的左边框或上边框没有被渲染出来。所以这个时候我们针对第一行和第一列，额外对它们设置左边和上边的边框的渲染。这样就达成了一个边框粗细一致的表格。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-边框渲染出现的问题">3.5 边框渲染出现的问题**<a href="#35-边框渲染出现的问题" class="hash-link" aria-label="3.5 边框渲染出现的问题**的直接链接" title="3.5 边框渲染出现的问题**的直接链接">​</a></h3><p>通过给每一个div单元格设置边框，因为<strong>第一行和第一列的边框渲染边框逻辑不一致，所以这些盒子在内容上的尺寸不一致。</strong>例如默认情况下每一个单元格的宽度是100px，高度是30px，边框宽度为1px，那么<strong>大多数单元格边框渲染后的尺寸变成了99px和29px，而第一行和第一列变成了98px和28px。</strong>或许你会说，<code>box-sizing</code>可以让它们的内容尺寸保持一致，但是内容保持一致了盒子总体宽度还一致吗？显然不一致。 那么为了解决这一个问题，我运用到了<strong>伪元素来渲染表格边框。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-表格样式改良---伪元素">4. 表格样式改良 - 伪元素<a href="#4-表格样式改良---伪元素" class="hash-link" aria-label="4. 表格样式改良 - 伪元素的直接链接" title="4. 表格样式改良 - 伪元素的直接链接">​</a></h3><p>伪元素的一个特点就是不会占据文档流位置，不会对盒子产生任何的宽高上的形变等。用伪元素之后，<strong>我们的表格就可以简单的渲染成100px，30px的尺寸，而不考虑宽度。这时候这些单元格没有任何的边框，接下来要借助伪元素来渲染边框。</strong>通过伪元素渲染边框就可以简单的设置100%宽高来让伪元素铺满100px和30px的div，然后同样是按一个方向来渲染之前的表格，但是这一次的结果是渲染完表格之后，<strong>所有单元格的尺寸仍然是100px和30px。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-实现内容的编辑">5. 实现内容的编辑**<a href="#5-实现内容的编辑" class="hash-link" aria-label="5. 实现内容的编辑**的直接链接" title="5. 实现内容的编辑**的直接链接">​</a></h3><p>在div中要实现内容的编辑，我们就需要借助<code>contenteditable</code>属性，设置了这个属性之后的div在被点击之后就会变成一个输入框，输入内容。</p><p>这个属性的编辑在生效后，我们要实现让编辑的最新的内容写入到state中，然后触发重新渲染。梳理一下完整的编辑逻辑就是：</p><p><strong>1. 正常通过state最原始的空数组渲染出空白的单元格</strong></p><p><strong>2. 单元格被点击，编辑内容</strong></p><p><strong>3. 单元格上面的input事件被触发，回调函数中实现获取最新输入的内容，然后更新state</strong></p><p><strong>4. state中对应单元格索引的数据改变，最新渲染单元格中内容改变</strong></p><hr><p>看起来渲染逻辑没有问题，但是在第3点到第4点，也就是重新渲染的过程中，如果我们输入框一直在触发输入，渲染也在被一直重新触发，那么是不是会出现一个问题，<strong>就是我们输入的内容因为重新渲染而消失，导致数据丢失等？ 而我出现的问题实际上是出现每次输入光标都会跑到最前面</strong></p><p>为了解决这样的一个问题，就要<strong>让输入和渲染内容的容器被区分开</strong>，但是让几个div叠加到单元格上，点击单元格实际触发的是另外的一个输入框，但是这样单元格会变得层级比较复杂，可能会更容易出现bug。我就想<strong>能不能用防抖来实现，也就是输入内容的时候并不立刻去重新渲染，而是等待一段时间。</strong>事实上，并不能行得通，因为如果在输入阶段停下来引起了防抖函数的执行，那么仍然会重新执行，光标仍然会跑到最前面。 </p><p>参考了一些单元格的产品，我觉得在这上面做一个妥协也是行得通的，就是在<strong>单元格进行失焦的时候再来重新渲染。</strong>在后期也可以在数据的保护上更下功夫。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-实现单元格选中的高亮边框">6. 实现单元格选中的高亮边框<a href="#6-实现单元格选中的高亮边框" class="hash-link" aria-label="6. 实现单元格选中的高亮边框的直接链接" title="6. 实现单元格选中的高亮边框的直接链接">​</a></h3><p>实现高亮边框，修改单元格的伪元素的边框不太现实，这样也可能造成更多的元素的属性的修改，对性能可能不太有利。所以最好是单独用一个div来实现，而表格的尺寸和位置都通过元素的计算来实现。 比如我点击了一个row索引为10，column索引为8的单元格，那么<strong>根据这一个单元格索引结合每一个单元格的尺寸配置数据，来计算出单元格需要偏移多少个像素，宽度高度是多少。</strong>选中多个单元格也是如此，无非就是多计算几个单元格的尺寸。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-实现单元格的伸缩和虚拟列表适应全屏等">7. 实现单元格的伸缩和虚拟列表适应全屏等<a href="#7-实现单元格的伸缩和虚拟列表适应全屏等" class="hash-link" aria-label="7. 实现单元格的伸缩和虚拟列表适应全屏等的直接链接" title="7. 实现单元格的伸缩和虚拟列表适应全屏等的直接链接">​</a></h3><p>上面已经说明了这个表格是如何通过数据去驱动整个视图的渲染的，那么要做单元格的伸缩等，从css的渲染上入手即可。</p><p>根据一个配置，计算出这个配置对哪些索引的表格尺寸进行了修改，然后在注入css属性的时候根据这个计算进行动态的改变，我觉得这是一个比较开放的功能，没有很多需要特别强调的点，如果要进行优化性能，无非是针对大量数据的场景下表格尺寸计算的算法速度和空间占用等。</p><p>虚拟列表这些，也都是那样的方案，针对场景做做调整即可。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/9/1/ passing props 阻止styled-components的props绑定到原生dom上"> passing props 阻止styled-components的props绑定到原生dom上</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-09-01T00:00:00.000Z" itemprop="datePublished">2023年9月1日</time> · <!-- -->阅读需 6 分钟</div></header><div class="markdown" itemprop="articleBody"><p>styled-components 是用于 react 的一个 css in js 的库。</p><p>下面是一个 styled-components 创建的一个 css in js 的组件。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">Styled</span><span class="token plain"> borderColor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;red&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token maybe-class-name">Styled</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-passing-props">1. Passing props<a href="#1-passing-props" class="hash-link" aria-label="1. Passing props的直接链接" title="1. Passing props的直接链接">​</a></h2><p><a href="https://zh-hans.react.dev/learn/passing-props-to-a-component" target="_blank" rel="noopener noreferrer">React - Passing props</a></p><p><a href="https://styled-components.com/docs/basics#passed-props" target="_blank" rel="noopener noreferrer">Styled-components - Passed props</a></p><p>在 React 中的 passing props 和 styled-components 的 passed props，都是对 props 传递的处理。</p><p>对于标准的 html 标签和 JSX 的标签，传递 props 的时候造成的结果是不一样的。</p><p>如果是<strong>标准的 html 标签</strong>，例如一个<code>img</code>标签，<strong>传递的<code>width</code>、<code>height</code>甚至<code>className</code>（className 是 react 符合 html 标准的属性，会被注入成 class）都会被直接传递到 dom 中。</strong>也就是说最后在页面上检查元素标签的时候会出现这些 property。就像下面这样</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">img</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">width</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">100</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">xxx</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是是一个 React 的 JSX 组件，我们在这个组件上传递 props，这个 props 就是属于这个 react 的组件，并不会注入到任何的 html 标签上，因为这就相当于是一个函数的参数。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-styled-components-中的参数传递">2. styled-components 中的参数传递<a href="#2-styled-components-中的参数传递" class="hash-link" aria-label="2. styled-components 中的参数传递的直接链接" title="2. styled-components 中的参数传递的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="编写组件">编写组件<a href="#编写组件" class="hash-link" aria-label="编写组件的直接链接" title="编写组件的直接链接">​</a></h3><p><strong>但是在 styled-components 中，会因为组件创建的逻辑产生不同的结果。</strong>我们会通过<code>styled.div</code>之类的去创建一个组件，通过<code>styled-components</code>创建出一个 React 的组件，但是有些时候我们会对这个组件进行参数的传递，比如下面这种情况。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//这只是其中的一种传参的写法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    styled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">div</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token literal-property property">customColor</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> string </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> customColor </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> css</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string css language-css"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string css language-css">            </span><span class="token template-string css language-css property">height</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token template-string css language-css"> </span><span class="token template-string css language-css number" style="color:rgb(247, 140, 108)">100</span><span class="token template-string css language-css unit">px</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token template-string css language-css"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string css language-css">            </span><span class="token template-string css language-css property">color</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token template-string css language-css"> </span><span class="token template-string css language-css interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string css language-css interpolation">customColor</span><span class="token template-string css language-css interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token template-string css language-css"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string css language-css">        </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="组件传参">组件传参<a href="#组件传参" class="hash-link" aria-label="组件传参的直接链接" title="组件传参的直接链接">​</a></h3><p>此时我们要对这个组件及进行传参，传参的方式是和 React 一样的。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token literal-property property">ReactComponent</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">FC</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">Component</span><span class="token plain"> customColor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;red&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="最终渲染-dom-的结果">最终渲染 dom 的结果<a href="#最终渲染-dom-的结果" class="hash-link" aria-label="最终渲染 dom 的结果的直接链接" title="最终渲染 dom 的结果的直接链接">​</a></h3><p>通过这样的方式进行传参之后，在页面中检查元素会发现，div 标签上面出现了一个 customcolor=&quot;red&quot;（注意 大驼峰被改成了全小写。</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">sc-xxxx</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">customcolor</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">red</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>styled-components 还会进行下面的一个提示的警告。</p><blockquote><p>React does not recognize the <code>customColor</code> prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase <code>customcolor</code> instead. If you accidentally passed it from a parent component, remove it from the DOM element.</p></blockquote><p><strong>我们的预期是最终在页面中渲染结果如下</strong></p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">sc-xxxx</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>显然实际结果和我们的预期结果之间，差了一个不希望被注入到 dom 标签上面的 property。这要根据 styled-components 的 props 的 passing 逻辑来处理，根据文档中的说法，任何使用在 styled-components 的组件上面的 property 都会被注入到 html 中，<strong>如果我们不想被注入，要在属性前面加$来屏蔽掉</strong>。所以最终的解决方法是如下</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方法">解决方法<a href="#解决方法" class="hash-link" aria-label="解决方法的直接链接" title="解决方法的直接链接">​</a></h3><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    styled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">div</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token literal-property property">$customColor</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> string </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> $customColor </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> css</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string css language-css"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string css language-css">            </span><span class="token template-string css language-css property">height</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token template-string css language-css"> </span><span class="token template-string css language-css number" style="color:rgb(247, 140, 108)">100</span><span class="token template-string css language-css unit">px</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token template-string css language-css"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string css language-css">            </span><span class="token template-string css language-css property">color</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token template-string css language-css"> </span><span class="token template-string css language-css interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string css language-css interpolation">customColor</span><span class="token template-string css language-css interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string css language-css punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token template-string css language-css"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string css language-css">        </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token literal-property property">ReactComponent</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">FC</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">Component</span><span class="token plain"> $customColor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;red&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样最后渲染 dom 的结果如下</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">sc-xxxx</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-不希望被注入到-dom-的-property-被注入有什么影响">3. 不希望被注入到 dom 的 property 被注入，有什么影响<a href="#3-不希望被注入到-dom-的-property-被注入有什么影响" class="hash-link" aria-label="3. 不希望被注入到 dom 的 property 被注入，有什么影响的直接链接" title="3. 不希望被注入到 dom 的 property 被注入，有什么影响的直接链接">​</a></h2><p>首先，符合规范的 dom 的 properties 都是全小写的，有些会用 杠 来连接。那么至少在 React 的严格模式下，我们不是规范的 property，都会被认为是对组件的传参，所以原生的 React 的组件对于这个问题，很多情况下是没有什么影响的。</p><p>但是在 styled-components 中，我们不希望被注入到 html 中的属性被注入上去了，并且本来应该是大驼峰的，最后变成了小驼峰，这样在 dom 元素检查上会造成一定的误解。</p><p>而我记录这个问题的原因是，在我有进行单元测试的时候，生成的快照上面的标签上突然生成了这样的一个 property，控制台还抛出了大量的警告，也就是上面提到的那个警告信息。当时我并没有意识到这个<code>passing props</code>概念的存在，我认为只有标准的 property 才会被注入到 html 标签上，其他不符合标准的并不会被注入到 dom 上，而是被当作是组件的传参，但实际并不是这样。</p><p>我想了一下，我当时修改了一些组件的传参方式，就造成了这样的结果，我觉得<strong>在灵活的 React 组件传参方式上，有的方式会造成这样的结果，而有的不会</strong>，这是并不希望出现的，所以最好的是根据官方的文档用$符号来确定性的将 property 排除掉。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/8/30/ 动态生成自定义svg的解决方法"> 动态生成自定义svg的解决方法</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-08-30T00:00:00.000Z" itemprop="datePublished">2023年8月30日</time> · <!-- -->阅读需 2 分钟</div></header><div class="markdown" itemprop="articleBody"><p>SVG 格式的文件，是可缩放的矢量图像文件，它根据设定的一些参数和曲线直线等算法来渲染出来图片，所以它能很容易去自定义图片的样式。</p><p>当然在前端中，svg 运用到 html 上是更加的方便，它可以直接使用标签的形式来被渲染出来，<strong>标签中的一些属性等来决定渲染的 svg 的样式</strong>，那么根据这样的一个特点，我们就可以方便的对不同的 svg 设置不同的样式等。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-如何渲染自定义的-svg-图片来运用到-js-的渲染中">1. 如何渲染自定义的 svg 图片来运用到 js 的渲染中<a href="#1-如何渲染自定义的-svg-图片来运用到-js-的渲染中" class="hash-link" aria-label="1. 如何渲染自定义的 svg 图片来运用到 js 的渲染中的直接链接" title="1. 如何渲染自定义的 svg 图片来运用到 js 的渲染中的直接链接">​</a></h3><p>使用 btoa 来构建 base64 的 svg 图片。</p><p>下面来封装一个函数，简单的传入一个 svg 的 fill 属性支持的颜色字符串，来生成不同颜色的 svg 图片。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//genSVG.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//这里的svg的iconfont中的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">default</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">color</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> svg </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string string" style="color:rgb(195, 232, 141)">    &lt;svg fill=&quot;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">color</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string string" style="color:rgb(195, 232, 141)">&quot; t=&quot;1692813506367&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1064 1024&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;1440&quot; width=&quot;200&quot; height=&quot;200&quot;&gt;&lt;path d=&quot;M512 0c282.781538 0 512 229.218462 512 512S794.781538 1024 512 1024s-512-229.218462-512-512S229.218462 0 512 0z&quot;  p-id=&quot;1441&quot;&gt;&lt;/path&gt;&lt;/svg&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token template-string string" style="color:rgb(195, 232, 141)">    </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 转换为data URI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> svgDataURI </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;data:image/svg+xml;base64,&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">btoa</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">svg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> svgDataURI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-总结">2. 总结<a href="#2-总结" class="hash-link" aria-label="2. 总结的直接链接" title="2. 总结的直接链接">​</a></h3><p>很多时候会认为图片这种非代码的不能去动态的修改，其实可以换一个思路就是去构建base64编码来实现。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/7/20/ github pr和变基合并提交记录"> github pr和变基合并提交记录</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-20T00:00:00.000Z" itemprop="datePublished">2023年7月20日</time> · <!-- -->阅读需 6 分钟</div></header><div class="markdown" itemprop="articleBody"><p>根据上一篇博客，可以进行代码的提交，那么这里记录一下关于在github上面提交pr的时候遇到的一些问题等。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pr提交">pr提交<a href="#pr提交" class="hash-link" aria-label="pr提交的直接链接" title="pr提交的直接链接">​</a></h2><p>在我们需要对一个仓库进行代码贡献的时候，<strong>先fork代码到自己的仓库，然后在本地去clone</strong>，这是一般的比较标准的流程。</p><p>那么在clone完之后，本地会自动初始化一个仓库，这个仓库和github管理的仓库的<strong>版本是一致的</strong>，由于github的远程仓库是刚从需要贡献代码的仓库fork过来的，那么它们2个仓库的版本也是一致的。</p><p>因为我们是提交pr，所以实际上对贡献代码的版本管理是管理员去进行的，我们只需要管理我们自己的仓库就行了，那么我们要做的就是在这个版本的基础上面去修改代码，然后提交到远程仓库，这样在远程仓库中就有了一些提示，其中就有<code>contribute</code>等等（也可以到贡献仓库中去new Pr，也可以识别到代码的更改）。 我们进行<code>contribute</code>之后就会生成一个<code>pr</code>，<code>pr</code>中展示了我们的仓库的一些提交记录，可以看到修改了哪些内容等等。 对于提交的内容，别人可以在代码出进行评论等，等待没有任何分歧之后，管理员可以去允许合并代码。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="合并提交记录">合并提交记录<a href="#合并提交记录" class="hash-link" aria-label="合并提交记录的直接链接" title="合并提交记录的直接链接">​</a></h2><p><strong>这里合并提交记录用到变基，通过强制推送来达到远程仓库和本地仓库保持一致的干净提交历史记录，在使用的时候一定要把握代码的安全性，以防因为强制推送带来代码的冲突等导致代码损失。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pr中提交多个代码导致pr中的提示信息杂乱--变基">pr中提交多个代码，导致pr中的提示信息杂乱 —— 变基<a href="#pr中提交多个代码导致pr中的提示信息杂乱--变基" class="hash-link" aria-label="pr中提交多个代码，导致pr中的提示信息杂乱 —— 变基的直接链接" title="pr中提交多个代码，导致pr中的提示信息杂乱 —— 变基的直接链接">​</a></h3><p>比如我们提交了一段代码，但是有人说这个代码有些地方不好，于是我们在提交了第一次的版本上又进行了更新和推送，那么我们的远程仓库就比贡献仓库多了2个提交记录，在pr中也会有相应的提交记录提示。此时我们发现有个地方写错了，我们修改后又提交了一个记录。 </p><p>根据上述的情形，已经提交了3条记录，其中第1条记录是我们的第一个修改思路，第2，3条记录是对第1个记录的优化，显然我们不需要将第二次优化分成2，3这两条记录，我们需要做的就是变基，将2，3条记录中的代码通过变基将提交记录合并到2中，远程仓库中以及pr中多余的提示信息都会相应的被合并。</p><p>首先我们要做的就是通过<code>git log</code>来查看commit hash值以及查看3条记录信息。</p><div class="language-git codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-git codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出的内容将会是这样</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">第三次提交内容 21j31239802173124h12h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第二次提交内容 128930218312j312mn3lk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第一次提交内容 ji123n21jk3kj21h312h3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来我们使用变基，通过指明一个我们想合并到的一个能让提交log信息变干净的一次提交记录的hash值，像下面这样</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git rebase -i 128930218312j312mn3lk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后就会输出下面的信息。<strong>我们要做的就是把前面的pick改成drop，这样的话，输出的这几条记录就会合并成pick的这一条记录。</strong></p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> pick 第三次提交内容 21j31239802173124h12h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> drop 第三次提交内容 21j31239802173124h12h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token plain">pick 第二次提交内容 128930218312j312mn3lk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完成之后，通过<code>vim</code>的命令<code>!wq</code>来保存退出，会输出一些完成rebase的内容。</p><p>我们再次通过<code>git log</code>来查看，发现前面的三条记录现在只剩下了两条。但是远程仓库中实际上还是三条提交记录，那么我们要做的是推送当前仓库的提交。</p><p><strong>在保证没有任何的代码冲突以及远程代码的最新提交，保持好rebase不会带来所有损失的情况下，用<code>git push --force ....</code>来进行强制推送。</strong>在完成之后，远程仓库以及引用了<strong>第三次提交记录</strong>的信息都会被删除，这样也就保持了提交信息的干净。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/7/18/ git本地管理到github的关联"> git本地管理到github的关联</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-18T00:00:00.000Z" itemprop="datePublished">2023年7月18日</time> · <!-- -->阅读需 7 分钟</div></header><div class="markdown" itemprop="articleBody"><p>在最近和一些人解决代码上面的问题的时候，其中既有外行也有内行，也有的稍微知道一点点比如github这种。根据我所见到的情况来总结一下就是，你必须要很了解github如何去快速的创建
一个本地的仓库，然后如何去配置一个git的环境之后创建本地的git仓库，然后通过ssh或者https的连接来与github的在线仓库进行连接（我通常使用ssh来连接），如果对git和github了解
不够深刻的话，会遇到很多的问题。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="从下载git到创建git本地仓库">从下载git到创建git本地仓库<a href="#从下载git到创建git本地仓库" class="hash-link" aria-label="从下载git到创建git本地仓库的直接链接" title="从下载git到创建git本地仓库的直接链接">​</a></h2><p>我们要用github（或者gitlab等等）去管理代码，首先要做的是对本地的git仓库进行管理。那么<strong>第一点是下载git这个软件，在git的官网直接下载git的程序，下载完成之后对git进行环境变量的配置，这样我们就可以在任意的终端中使用git的所有命令了。</strong></p><p>接下来我们要创建本地的git管理仓库，首先要将终端的路径选择到我们要创建git管理的文件夹地址，使用命令</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样下来git帮我们初始化了仓库，你可以发现当前文件夹中自动创建了一个.git的文件，依靠这个文件就可以通过git来管理仓库中的代码。 <code>ls -a(linux/macos显示当前目录所有文件)</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="管理代码">管理代码<a href="#管理代码" class="hash-link" aria-label="管理代码的直接链接" title="管理代码的直接链接">​</a></h2><p>所谓管理代码，就是对本地的代码进行记录，记录我们的修改，记录我们的提交历史等等。其中比较常用的命令也就是</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git add . //添加所有的文件到暂存区</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git commit -m &quot;提交内容&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git log //查看提交历史</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这些都是git的命令，为了更好的了解它们，应该到git的官网中详细的了解git的命令和规则。 这里我们的重点是如何通过本地代码来关联到github上面，实现github在线托管我们的代码。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="关联github仓库ssh">关联github仓库（ssh）<a href="#关联github仓库ssh" class="hash-link" aria-label="关联github仓库（ssh）的直接链接" title="关联github仓库（ssh）的直接链接">​</a></h2><p><strong>问题现在就来了，在github创建了仓库，但是本地如何知道哪个github账号是我们的?</strong></p><p>ssh的连接是通过公钥和私钥的方式来连接的，所以我们要做的是在本地生成一些密钥，然后在github上面注册。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-为git配置全局的属性">1. 为git配置全局的属性<a href="#1-为git配置全局的属性" class="hash-link" aria-label="1. 为git配置全局的属性的直接链接" title="1. 为git配置全局的属性的直接链接">​</a></h3><p>这样的作用是为git的命令提供一些参数，如果遇到user.name的参数那么就会使用后面的值，那么我们要用到github所以就把它们设置成github账号相关的值。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git config --global user.name &quot;name&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git config --global user.email &quot;email&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-生成私钥和公钥">2. 生成私钥和公钥<a href="#2-生成私钥和公钥" class="hash-link" aria-label="2. 生成私钥和公钥的直接链接" title="2. 生成私钥和公钥的直接链接">​</a></h3><p>输入以下命令之后就会出现一些提示，根据提示来选择即可。通常都选是，（有yes/no的可能默认为no，手动输入yes）。提示生成了密钥的路径，找到 <strong>.pub后缀的这个就是公钥</strong>。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -t rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-github绑定公钥">3. github绑定公钥<a href="#3-github绑定公钥" class="hash-link" aria-label="3. github绑定公钥的直接链接" title="3. github绑定公钥的直接链接">​</a></h3><p>在github的设置里面，侧边菜单栏里面有一个SSH相关的选项，进去点击<strong>add key</strong>，那么把私钥的内容复制到下面的输入框，上面的标题填写自己想要的，点击添加提示添加成功那么说明github和本机已经配置好了ssh连接的一些内容，接下来通过ssh来连接即可。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-配置ssh">4. 配置ssh<a href="#4-配置ssh" class="hash-link" aria-label="4. 配置ssh的直接链接" title="4. 配置ssh的直接链接">​</a></h3><p>找到github仓库，点击绿色的大按钮，下面就有ssh了，复制ssh的内容。</p><p>接下来，到本地的仓库文件夹下打开文件夹，来添加远程git仓库的源。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git remote add origin(origin可以自己取名字) main &quot;git@github.com:.......&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>把复制的ssh的内容放在引号里面，这样回车确认之后如果没有提示错误应该就是配置好了。通过下列的命令来确认，会发现显示了一些fetch等等以及仓库地址等信息，可以检查是否是正确的。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git remote -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-推送代码到远程分支">5. 推送代码到远程分支<a href="#5-推送代码到远程分支" class="hash-link" aria-label="5. 推送代码到远程分支的直接链接" title="5. 推送代码到远程分支的直接链接">​</a></h3><p>接下来<strong>我们要把相应的分支推送到远程github仓库对应的分支（如果远程没有这个分支，会自动的创建）</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git branch //检查所有分支</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git chekout branch_name //切换到branch_name分支</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>这里有一个需要注意的点就是，我们在没有做add和commit的时候，branch不会显示任何内容。</strong></p><p>通过上面的命令已经切换到了我们需要推送的分支，前面我们也通过<code>git add .</code> <code>git commit ....</code>把修改的代码提交了，接下来是要进行push。</p><p><strong>如果我们的本地仓库版本和远程不一样，那么会造成代码的冲突，我们在push之前务必进行pull。</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git pull origin main</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git push -u origin main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以后我们只需要通过<code>add</code> <code>commit</code> <code>pull</code> <code>push</code>这一套流程，就可以完成代码的推送了。当然其中会遇到很多的坑，结合网络，会很容易解决的。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/7/15/ 页面大量dom的优化"> 页面大量dom的优化</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-15T00:00:00.000Z" itemprop="datePublished">2023年7月15日</time> · <!-- -->阅读需 5 分钟</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于dom优化的情况">关于dom优化的情况<a href="#关于dom优化的情况" class="hash-link" aria-label="关于dom优化的情况的直接链接" title="关于dom优化的情况的直接链接">​</a></h2><p>页面中有大量dom需要优化的情况可能分为2种，一种是大量的dom刚好铺满一个屏幕，另外一种是大量的dom渲染到一个页面上并且超出了一个屏幕。</p><p>对于前者，举例一种情况就是需要渲染<strong>几百个图片</strong>在一个完整的页面上，可能看到几百个图片的img标签并不是像百万级那么夸张，但是对于这样的渲染仍然还是有很多值得优化的空间。</p><p>对于后者，在前者的基础上还会加入一个对滚动时的优化，因为dom非常的多导致滚动的时候会掉帧，那么需要进行滚动优化，<strong>虚拟化列表</strong>就是其中的一个解决方法。</p><p><strong>对于滚动采用虚拟化列表即可解决了，这里只讲解如何优化dom的渲染性能</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dom的渲染优化">dom的渲染优化<a href="#dom的渲染优化" class="hash-link" aria-label="dom的渲染优化的直接链接" title="dom的渲染优化的直接链接">​</a></h2><p>如果我们要渲染几百个页面，现在我们用原生的js来做演示，那么我们需要创建几百个dom之后append到父元素中。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">const parent = document.getElementById(&quot;parent&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//循环800次</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for(let i = 0; i &lt; 800; i++){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    const img = document.createElement(&quot;img&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    img.src = &quot;....jpg&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parent.appendChild(&quot;img&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样的逻辑会创建800个dom并且渲染到这个parent容器中（parent是一个div标签）。<strong>当我们执行的时候，如果机器性能不是及其顶尖，那么你会发现页面会处于一个较长时间的加载中，并且你会发现如果你放一个按钮在页面上，这个时候你鼠标点击按钮是不能相应的，因为主线程正在被占用来渲染800个dom。</strong>到这里就出现了第一个优化的点<strong>异步加载</strong>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="异步加载">异步加载<a href="#异步加载" class="hash-link" aria-label="异步加载的直接链接" title="异步加载的直接链接">​</a></h3><p>异步加载我们就要使用到异步任务来进行dom的渲染，其中setTimeout这个定时器api就可以实现异步任务，setTimeout将执行的函数放入到异步任务队列中，当主线程的任务执行完成之后就进入到异步任务来执行这个任务，所以我们的主线程始终是不会被阻塞的。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">function createDOM(){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    setTimeout(()=&gt;{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        const img = document.createElement(&quot;img&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        img.src = &quot;....jpg&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        parent.appendChild(&quot;img&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },50)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>经过上面的封装，我们把createDOM封装成了一个创建一个异步任务来渲染一次dom的逻辑，那么我们要渲染800个就需要调用800次createDOM。其中设置定时器的时间间隔为50毫秒，那么每隔50毫秒就会创建一个dom并添加到父容器中，并且会发现它在渲染的时候我们的鼠标以及页面都不会被阻塞卡住，仍然可以触发一些事件。</p><p><strong>提到了异步加载，还有一个比较重要的api，requestAnimationFrame。</strong>这个api在动画中也很常用，它的作用是在一帧渲染之后执行函数，至于每秒渲染多少帧，通常根据屏幕目前刷新率来确定。在更多情况下使用这个api具有更大的优势。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">const count = 800</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let current = 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">function createDOM(){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if(current &gt;= count) return</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    const img = document.createElement(&quot;img&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    img.src = &quot;....jpg&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parent.appendChild(&quot;img&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    current++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requestAnimationFrame(createDOM)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">requestAnimationFrame(createDOM)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://juejin.cn/post/7062178363800027173" target="_blank" rel="noopener noreferrer">requestAnimationFrame的讲解</a></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/4/27/ webpack chunk与runtime优化"> webpack chunk与runtime优化</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-04-27T00:00:00.000Z" itemprop="datePublished">2023年4月27日</time> · <!-- -->阅读需 10 分钟</div></header><div class="markdown" itemprop="articleBody"><p>在学习webpack的过程中，遇到了一个webpack的运行时代码所带来的问题。</p><p>比如<code>optimization</code>中<code>runtimeChunk</code>的配置等，会出现带有runtime的文件，在我们使用<strong>output.dependOn属性配置</strong>的时候，也会生成runtime标识的文件，那么这个runtime文件到底是什么？</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">const path = require(&quot;path&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">module.exports = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> mode: &quot;development&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  entry: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    index: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      import: &quot;./src/index.js&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      dependOn: &quot;shared&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    &quot;other-bundle&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      import: &quot;./src/other-bundle.js&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      dependOn: &quot;shared&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    shared: &quot;lodash&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> output: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   filename: &quot;[name].[contenthash].bundle.js&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   path: path.resolve(__dirname, &quot;dist&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   clean: true,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> plugins: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   new HtmlWebpackPlugin({</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     title: &quot;资源输出&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     filename: &quot;webpack.html&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   }),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> ],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面这是一个<code>webpack.config.js</code>的配置文件，其中的重点就在<code>entry</code>里面，看到其中配置了一个<code>dependOn</code>，然后依赖的是一个新的入口文件，那么理论上生成文件就会有至少3个，<code>index.[hash].js</code>，<code>other-bundle.[hash].js</code>和<code>shared.[hash].js</code>。现在没有什么问题，就是我们简单的配置了3个入口文件，然后其中2个依赖与另外一个chunk文件，其中包含的是<code>lodash</code>这个库，所以<code>shared.[hash].js</code>中存放的是lodash的代码。然后继续看下面的说明</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimizationruntimechunk">optimization.runtimeChunk<a href="#optimizationruntimechunk" class="hash-link" aria-label="optimization.runtimeChunk的直接链接" title="optimization.runtimeChunk的直接链接">​</a></h3><p><strong>现在我们引入一个新的配置，<code>optimization.runtimeChunk</code>。对于runtimeChunk设置为&#x27;single&#x27;的作用就是，为所有的chunk文件生成一个共享的runtime的文件，这样所有对模块引入或者初始化的代码都在这个共享文件中实现。设置成&#x27;true&#x27;（或者&#x27;multiple&#x27;）就会为每一个chunk生成一个单独的runtime的文件。</strong></p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">const path = require(&quot;path&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">module.exports = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> mode: &quot;development&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> entry: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   index: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     import: &quot;./src/index.js&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     dependOn: &quot;shared&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   &quot;other-bundle&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     import: &quot;./src/other-bundle.js&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     dependOn: &quot;shared&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   shared: &quot;lodash&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  optimization: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    runtimeChunk: true,//默认是false，true对应的是&#x27;multiple&#x27;，还可以选择&#x27;single&#x27;。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> output: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   filename: &quot;[name].[contenthash].bundle.js&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   path: path.resolve(__dirname, &quot;dist&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   clean: true,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> plugins: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   new HtmlWebpackPlugin({</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     title: &quot;资源输出&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     filename: &quot;webpack.html&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   }),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> ],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>那么我们设置了这个属性之后进行编译，产生的文件会多出一个<code>runtime~shared.....</code>的文件。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="runtime文件的内容">runtime文件的内容<a href="#runtime文件的内容" class="hash-link" aria-label="runtime文件的内容的直接链接" title="runtime文件的内容的直接链接">​</a></h3><p>我们现在要知道<code>runtime~shared...</code>是怎么和<code>shared.....js</code>文件联系起来的，这样就可以分析为什么能够生成出一个runtime文件来。</p><p>下面是<code>shared.js</code>生成的入口js文件的代码开头，看的出来是往一个数组<code>self[....]</code>中push了一些数组，通过注释和测试环境的代码，可以分析出来这个数组中设置了一个对象，是我们之前在<code>shared.js</code>中引入的lodash的代码。<strong>那么这个self显然是一个全局的对象，然后现在我们给他push了一些值。</strong>那么这个属性我们接下来再<code>runtime</code>文件中看一看。</p><p><strong>shared.xxxxx.js</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> or disable the </span><span class="token keyword module" style="font-style:italic">default</span><span class="token plain"> devtool </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;devtool: false&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token maybe-class-name">If</span><span class="token plain"> you are looking </span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> production</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ready output files</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> see mode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;production&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">https</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">webpack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">js</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">org</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">configuration</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">mode</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;webpackChunkwebpack_learn&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;webpackChunkwebpack_learn&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;shared&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/***/</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./node_modules/lodash/lodash.js&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*!***************************************!*\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  !*** ./node_modules/lodash/lodash.js ***!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  \***************************************/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/***/</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">module</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> exports</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> __webpack_require__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">eval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">          &quot;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* module decorator */</span><span class="token plain"> module </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> __webpack_require__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">nmd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\nvar __WEBPACK_AMD_DEFINE_RESULT__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**\n * @license\n * Lodash &lt;https://lodash.com/&gt;\n * Copyright OpenJS Foundation and other contributors &lt;https://openjsf.org/&gt;\n * Released under MIT license &lt;https://lodash.com/license&gt;\n * Based on Underscore.js 1.8.3 &lt;http://underscorejs.org/LICENSE&gt;\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors\n */</span><span class="token plain">\n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Used as a safe reference for `undefined` in pre-ES5 environments. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token keyword nil" style="font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Used as the semantic version number. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">VERSION</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;4.17.21&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Used as the size to enable large array optimizations. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">LARGE_ARRAY_SIZE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Error message constants. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">CORE_ERROR_TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Unsupported core-js use. Try https://npms.io/search?q=ponyfill.&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">\n      </span><span class="token constant" style="color:rgb(130, 170, 255)">FUNC_ERROR_TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Expected a function&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">\n      </span><span class="token constant" style="color:rgb(130, 170, 255)">INVALID_TEMPL_VAR_ERROR_TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Invalid `variable` option passed into `_.template`&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Used to stand-in for `undefined` hash values. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">HASH_UNDEFINED</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;__lodash_hash_undefined__&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Used as the maximum memoize cache size. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">MAX_MEMOIZE_SIZE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">500</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Used as the internal argument placeholder. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PLACEHOLDER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;__lodash_placeholder__&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">\n\n  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** Used to compose bitmasks for cloning. */</span><span class="token plain">\n  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">CLONE_DEEP_FLAG</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">\n      </span><span class="token constant" style="color:rgb(130, 170, 255)">CLONE_FLAT_FLAG</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">\n      </span><span class="token constant" style="color:rgb(130, 170, 255)">CL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面是对应的runtime的代码，找到了这样的代码。其中对现在已有的self中的值进行调用<code>webpackJsonpCallback</code>（调用前执行了bind绑定，这个场景下是null）。
然后<strong>重写了push，将push重写成了webpackJsonpCallback中实现的方法，最后会移动到<strong>webpack_require</strong>.0的逻辑中去。</strong>也就是说在此之后在self<!-- -->[&#x27;webpackChunkwebpack_learn&#x27;]<!-- -->中的push操作，都会被以这里的逻辑来执行。显然runtime文件会优先于入口文件去引入到html中。</p><p><strong>shared.runtime.xxxx.js</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">                installedChunks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">chunkId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">            </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> __webpack_require__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">O</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">        </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> chunkLoadingGlobal </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;webpackChunkwebpack_learn&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;webpackChunkwebpack_learn&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">        chunkLoadingGlobal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">forEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">webpackJsonpCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">        chunkLoadingGlobal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">push</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> webpackJsonpCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> chunkLoadingGlobal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chunkLoadingGlobal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/************************************************************************/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/******/</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>那么现在就知道了，我们生成的这个runtime的文件，实际上是对入口文件模块的处理。我们在入口文件中会将模块的所有加载进行执行，<strong>生成runtime文件之后，在入口文件中对模块的处理的逻辑就会被转移到这个runtime文件中来执行。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="关于runtime代码的处理">关于runtime代码的处理<a href="#关于runtime代码的处理" class="hash-link" aria-label="关于runtime代码的处理的直接链接" title="关于runtime代码的处理的直接链接">​</a></h3><p>那么，现在比如我们有2个js文件，其中都引入了lodash的库。在我们不设置任何对runtime有影响的webpack的配置的时候，打包后<code>lodash</code>的模块会被加入到这2个打包的js文件中去。当我们对这2个js文件设置一个<code>dependOn</code>属性，<strong>然后<code>dependOn</code>的模块依赖的是<code>lodash</code>，打包后会发现我们之前的2个js文件中的<code>lodash</code>的代码都被转移到了一个新的chunk文件中去。那么这就是我们第一个使用方法，就是对重复模块的抽离。</strong></p><p>这里没有很好的体现我们对运行时代码的利用，但是在下面的一个例子很能体现。同样是2个js文件，还有一个<code>count.js</code>中导出了一个对象，其中的value属性为0，我们在另外2个js文件中都实现的是对这个对象的值自增。</p><p><strong>首先我们不对runtime进行任何的处理，显然这个时候<code>count.js</code>会分别存在于那2个js文件中，那么这个时候如果在html中来引入解析的话，结果就是独立的2个对count对象进行初始化的代码，形成的也是2个独立的作用域。</strong></p><p>那么这个时候我们设置<code>optimization.runtimeChunk=&#x27;single&#x27;</code>，让所有一切的chunk都形成一个<code>runtime</code>，这样这2个js文件中所有的内容都会push到runtime文件中去（push显然就是上面提到过的被重写的push），那么最终所有的作用域都会在<code>runtime</code>文件中形成，通过webpack对重复module的过滤处理等，最终重复的模块全部都会在这个runtime中引入一次。</p><p><strong>实际上，无论我们设不设置<code>optimization</code>这个参数，最终的模块都会通过webpack的运行时的函数去加载，第一个例子在优化前是<code>lodash</code>分别在2个运行时代码中加载，在我们设置<code>dependOn</code>之后就是将这2个运行时抽离成一个独立的chunk来通过运行时加载<code>lodash</code>。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="多runtimechunk">多runtimeChunk<a href="#多runtimechunk" class="hash-link" aria-label="多runtimeChunk的直接链接" title="多runtimeChunk的直接链接">​</a></h3><p>也就是设置<code>optimization.runtimeChunk=true</code>，这个时候，webpack会对每一个chunk文件进行修改，让其中的逻辑转移到runtime中去执行。虽然每个chunk生成了单独的runtime的文件，但是一般情况下runtime文件中都是执行一样的逻辑，上面提到的对<code>self</code>中对象的引用也都是同一个，所以这个时候上面提到的<code>count</code>也还是只是被初始化一次的。但是在官网中代码分离板块中提到过，如果使用多入口的时候，还是要设置<code>optimization.runtimeChunk=single</code>，这样至少可以确保百分之不会造成模块的多次实例化等错误。这在<a href="/webpack5/打包优化/运行时单一实例选项">运行时单一实例</a>中也有所体现。</p></div></article><nav class="pagination-nav" aria-label="博文列表分页导航"></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.8ced35b2.js"></script>
<script src="/assets/js/main.27ec5e19.js"></script>
</body>
</html>